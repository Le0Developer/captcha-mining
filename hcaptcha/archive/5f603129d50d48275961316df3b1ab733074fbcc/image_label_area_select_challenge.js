/* https://hcaptcha.com/license */
var image_label_area_select=function(t,i,e,s,n,o,h,a,l){"use strict";n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n["default"]:n,h=h&&Object.prototype.hasOwnProperty.call(h,"default")?h["default"]:h;var r=new s.Theme;function p(t){i.Extend.self(this,i.BaseComponent),this.bounding=null,this.dimensions=null,this.scale=1,this._image=null,this._aspect=1,this._visible=!1,this._offset=0,this.element=this.initComponent(o.Path)}function c(t){i.Extend.self(this,i.BaseComponent),this.bounding=null,this.dimensions=null,this.scale=1,this._aspect=1,this._visible=!1,this._offset=0,this._videoPlayer=null,this._handlePauseEvent=this._handlePauseEvent.bind(this),this.element=this.initComponent(o.Path)}function u(t){i.Extend.self(this,i.BaseComponent),this.config=t||{},this.bounding={left:0,top:0,right:0,bottom:0},this.dimensions=null,this.scale=1,this._asset=null,this.element=this.initComponent(o.Path),this.state={pendingVisibility:null,visible:!1,isLoading:!1}}function d(){this._radius=15,this._lineWidth=4,this._color=l.Color.outline}function y(t){i.Extend.self(this,i.BaseComponent),this.config=t||{},this._scale=1,this._bounding=null,this._isLoading=!1,this.asset=this.initComponent(u,this.config),this.element=this.initComponent(o.Path),this.element.fillColor="#ebebeb",this.element.fill=!1,this.spinnerAnimation=new d}r.add("contrast",{component:{prompt:{main:{fill:"#fff",text:"#000"}},expandButton:{main:{fill:"#000"}}}}),r.add("grey-red",{component:{prompt:{main:{fill:"#6a6a6a"}},task:{main:{fill:"#fff"},selected:{border:"#FF0000"}},expandButton:{main:{fill:"#6a6a6a"}}}}),i.Extend.proto(p,i.BaseComponent),p.prototype.load=function(t){var e=this;return i.Loader.image(t,{crossOrigin:"Anonymous"}).then((function(t){null!==e.dom&&(e._image=t,e._aspect=t.width/t.height,e.size.call(e,e.areaWidth,e.areaHeight,e._offset))}))},p.prototype.getImage=function(){return this._image&&this._image.element.dom},p.prototype.inBounds=function(t){return t.x>=this.bounding.left&&t.x<=this.bounding.right&&t.y>=this.bounding.top&&t.y<=this.bounding.bottom},p.prototype.size=function(t,i,e,s){var n=1!==s?10:20,o=this._aspect,h=t-n,a=h/o;a>i-n&&(h=(a=i-n)*o);var l=(t-h)/2,r=e+(i-a)/2,p=l+h,c=r+a,u=[{x:l,y:r},{x:p,y:r},{x:p,y:c},{x:l,y:c}];this.element.setPoints(u),this.dimensions=this.element.getDimensions(),this.bounding=this.element.getBounding(),this.areaWidth=t,this.areaHeight=i,this.scale=this._image?h/this._image.width:1,this._offset=e||this._offset},p.prototype.draw=function(t){this._visible&&(t.ctx.save(),t.ctx.roundedRect(this.bounding.left,this.bounding.top,this.dimensions.width,this.dimensions.height,4),t.ctx.clip(),this._image&&t.ctx.drawImage(this._image.element.dom,this.bounding.left,this.bounding.top,this.dimensions.width,this.dimensions.height),t.ctx.restore())},p.prototype.display=function(t){this._visible=t},p.prototype.onDestroy=function(){this._image=null},i.Extend.proto(c,i.BaseComponent),c.prototype.load=function(t,e){var s=this;return i.Loader.video(t,{crossOrigin:"Anonymous"}).then((function(t){if(!t.element)throw new Error("Failed to load task video");s._videoPlayer=new a.Video(t.element,{autoplay:!1,loop:!0,muted:!0}),t.element.dom.addEventListener("pause",s._handlePauseEvent,!1),s._aspect=t.width/t.height,s.size.call(s,s.areaWidth,s.areaHeight,s._offset)}))},c.prototype.getVideo=function(){return this._videoPlayer.getVideoElement()},c.prototype.inBounds=function(t){return t.x>=this.bounding.left&&t.x<=this.bounding.right&&t.y>=this.bounding.top&&t.y<=this.bounding.bottom},c.prototype.size=function(t,i,e,s){var n=1!==s?10:20,o=this._aspect,h=t-n,a=h/o;a>i-n&&(h=(a=i-n)*o);var l=(t-h)/2,r=e+(i-a)/2,p=l+h,c=r+a,u=[{x:l,y:r},{x:p,y:r},{x:p,y:c},{x:l,y:c}];this.element.setPoints(u),this.dimensions=this.element.getDimensions(),this.bounding=this.element.getBounding(),this.areaWidth=t,this.areaHeight=i;var d=this._videoPlayer?this._videoPlayer.getVideoElement():null;this.scale=d?h/d.videoWidth:1,this._offset=e||this._offset},c.prototype.draw=function(t){var i=this._videoPlayer?this._videoPlayer.getVideoElement():null;this._visible&&i&&(t.ctx.save(),t.ctx.roundedRect(this.bounding.left,this.bounding.top,this.dimensions.width,this.dimensions.height,4),t.ctx.clip(),t.ctx.drawImage(i,this.bounding.left,this.bounding.top,this.dimensions.width,this.dimensions.height),t.ctx.restore())},c.prototype.display=function(t){this._visible=t,t?this._videoPlayer.play():this._videoPlayer.stop()},c.prototype._handlePauseEvent=function(){if(this._visible&&this._videoPlayer){var t=this._videoPlayer.getVideoElement();if(t)try{t.play()}catch(i){}}},c.prototype.onDestroy=function(){if(this._videoPlayer){var t=this._videoPlayer.getVideoElement();t&&t.removeEventListener("pause",this._handlePauseEvent),this._videoPlayer.stop(),this._videoPlayer=null}},i.Extend.proto(u,i.BaseComponent),u.prototype.load=function(t){var i=this,e=this.config.vlas;this.state.isLoading=!0;var s=e?c:p;return this._asset=this.initComponent(s),this._asset.load(t).then((function(t){return i.state.isLoading=!1,null!==i.state.pendingVisibility&&(i.display(i.state.pendingVisibility),i.state.pendingVisibility=null),t}))["catch"]((function(t){throw i.state.isLoading=!1,i._asset=null,t}))},u.prototype.display=function(t){this.state.visible=t,this.state.isLoading?this.state.pendingVisibility=t:this._asset&&this._asset.display(t)},u.prototype.inBounds=function(t){return!!this._asset&&this._asset.inBounds(t)},u.prototype.size=function(t,i,e,s){this._asset&&(this._asset.size(t,i,e,s),this.bounding=this._asset.bounding,this.dimensions=this._asset.dimensions,this.scale=this._asset.scale)},u.prototype.draw=function(t){this._asset&&this.state.visible&&this._asset.draw(t)},u.prototype.onDestroy=function(){this._asset=null,this.state.pendingVisibility=null},d.prototype.draw=function(t,i,s){var n=t.ctx,o=360*e.Render.time%360;n.save(),n.translate(i,s),n.rotate(o*Math.PI/180),n.beginPath(),n.arc(0,0,this._radius,.25*Math.PI,2*Math.PI),n.strokeStyle=this._color,n.lineWidth=this._lineWidth,n.stroke(),n.restore()},i.Extend.proto(y,i.BaseComponent),y.prototype.display=function(t){this.asset.display(t)},y.prototype.inAssetBounds=function(t){return this.asset.inBounds(t)},y.prototype.inBounds=function(t){return t.x>=this._bounding.left&&t.x<=this._bounding.right&&t.y>=this._bounding.top&&t.y<=this._bounding.bottom},y.prototype.getAssetBounding=function(){return this.asset.bounding},y.prototype.getAssetScale=function(){return this.asset.scale},y.prototype.size=function(t,i,e,s){var n=0+t,o=e+i,h=[{x:0,y:e},{x:n,y:e},{x:n,y:o},{x:0,y:o}];this.element.setPoints(h),this._bounding=this.element.getBounding(),this.asset.size(t,i,e,s),this.width=t,this.height=i,this._scale=s},y.prototype.load=function(t){var i=this;return this._isLoading=!0,this.asset.load(t).then((function(t){return i._isLoading=!1,t}))["catch"]((function(t){throw i._isLoading=!1,t}))},y.prototype.render=function(t){var i=this.element.getPoint(0);if(t.ctx.roundedRect(i.x,i.y,this.width,this.height,4/t.scale),t.ctx.fillStyle=this.element.fillColor,t.ctx.fill(),this._isLoading){var e=i.x+this.width/2,s=i.y+this.height/2;this.spinnerAnimation.draw(t,e,s)}else this.asset.draw(t)};var f=1-4/3*(Math.sqrt(2)-1);function g(){i.Extend.self(this,i.BaseComponent),this.shape="pin",this.x=0,this.y=0,this.opacity=1,this.tip=!1,this.mobile=!1,this._minimized=!1,this.fillColor=null,this.width=100,this.height=50,this.sale=1,this.pointHeight=10,this.pointWidth=15,this.path=this.initComponent(o.Path),this.path.fill=!0;for(var t={x:0,y:0},e=0;e<11;e++)this.path.addPoint(t);this.path.close(!0),this.bounding=this.path.getBounding()}function x(t,i,e,s,n,o){var h=e.x-s.width/2,a=e.x+s.width/2,l=e.y-n.height-s.height,r=e.y-n.height,p=function(t,i,e,s,n){for(var o=n*f,h=0,a=0,l=[],r=0;r<4;r++){var p={x:0,y:0},c={x:0,y:0},u={x:0,y:0},d={x:0,y:0},y={x:0,y:0},g={x:0,y:0};h=r<2?i:t,a=0===r||3===r?e:s,0===r?(p.x=h-n,p.y=a,c.x=h,c.y=a+n,u.x=p.x-o,u.y=p.y,d.x=p.x+o,d.y=p.y,y.x=c.x,y.y=c.y-o,g.x=c.x,g.y=c.y+o):1===r?(p.x=h,p.y=a-n,u.x=p.x,u.y=p.y-o,d.x=p.x,d.y=p.y+o,c.x=h-n,c.y=a,y.x=c.x+o,y.y=c.y,g.x=c.x-o,g.y=c.y):2===r?(p.x=h+n,p.y=a,u.x=p.x+o,u.y=p.y,d.x=p.x-o,d.y=p.y,c.x=h,c.y=a-n,y.x=c.x,y.y=c.y+o,g.x=c.x,g.y=c.y-o):3===r&&(p.x=h,p.y=a+n,c.x=h+n,c.y=a,u.x=p.x,u.y=p.y+o,d.x=p.x,d.y=p.y-o,y.x=c.x-o,y.y=c.y,g.x=c.x+o,g.y=c.y),l.push({point:p,handleIn:u,handleOut:d}),l.push({point:c,handleIn:y,handleOut:g})}return l}(h,a,l,r,i),c=function(t,i,e){var s=[];return s.push({point:{x:t+e.width/2,y:i},handleIn:{x:t+e.width/2+4*f,y:i},handleOut:{x:t+e.width/2-4*f,y:i}}),s.push({point:{x:t,y:i+e.height},handleIn:{x:t+4*f,y:i+e.height},handleOut:{x:t-4*f,y:i+e.height}}),s.push({point:{x:t-e.width/2,y:i},handleIn:{x:t-e.width/2+4*f,y:i},handleOut:{x:t-e.width/2-4*f,y:i}}),s}(e.x,r,n),u=0,d=0,y=null,g=Math.floor(t.getLength()/2);t.forEachPoint((function(t){u<g-1||u>g+1?(d=u>Math.ceil(g)?u-Math.ceil(g/2):u,y=p[d],t.set.apply(t,[y.point,y.handleIn,y.handleOut])):(y=c[d=u-(g-1)]).handleIn?t.set.apply(t,[y.point,y.handleIn,y.handleOut]):t.set(y.point),u+=1}),!0)}function m(){i.Extend.self(this,i.BaseComponent),this.text=null,this.visible=!1,this.scale=1,this.size=12,this.weight=500,this.typeface="Helvetica",this.color="#fff",this.align="center",this.baseline="middle",this.x=0,this.y=0}function v(t){i.Extend.self(this,i.BaseComponent),this.key=null,this.value=null,this.scale=1,this.width=75,this.height=20,this.mobile=!1,this.color=t,this.exhaustedColor=t.clone().saturation(.1).lightness(.75).getHex(),this.hoverColor=t.clone().lightness(.35).getHex(),this.defaultColor=t.getHex(),this.pin=this.initComponent(g),this.text=this.initComponent(m),this.text.display(!0),this.pin.setFill(this.defaultColor),this.pin.setPoint(0,0),this.x=0,this.y=0,this.dimensions=null,this.bounding=null,this.coords=null,this.placed=0,this.available=1,this.exhausted=!1}i.Extend.proto(g,i.BaseComponent),g.prototype.size=function(t,i,e){this.width=t/e,this.height=i/e,this.scale=e;var s=4/e,n={x:this.x,y:this.y},o={width:this.width,height:this.height},h={width:this.pointWidth/e,height:this.pointHeight/e};x(this.path,s,n,o,h),this.bounding=this.path.getBounding()},g.prototype.place=function(t,i){var e=t-this.x,s=i-this.y;this.path.move(e,s),this.x=t,this.y=i,this.bounding=this.path.getBounding()},g.prototype.move=function(t,i){this.path.move(t,i),this.x+=t,this.y+=i,this.bounding=this.path.getBounding()},g.prototype.setPoint=function(t,i){this.pointWidth=t!==undefined?t:this.pointWidth,this.pointHeight=i!==undefined?i:this.pointHeight;var e=4/this.scale,s={x:this.x,y:this.y},n={width:this.width,height:this.height},o={width:this.pointWidth/this.scale,height:this.pointHeight/this.scale};x(this.path,e,s,n,o),this.bounding=this.path.getBounding()},g.prototype.hitTest=function(t){var i=!1;return this.path.hitTest(t)&&(i={action:"move",target:this}),i},g.prototype.draw=function(t){t.ctx.save(),t.ctx.globalAlpha=this.opacity,this.path.fillColor=this.fillColor,this.path.draw(t),t.ctx.restore()},g.prototype.setFill=function(t){this.fillColor=t},g.prototype.minimize=function(t){this.alpha=!0===t?.8:1},i.Extend.proto(m,i.BaseComponent),m.prototype.set=function(t){this.text=h.getBestTrans(t)},m.prototype.place=function(t){this.x=t.x,this.y=t.y},m.prototype.move=function(t,i){this.x+=t,this.y+=i},m.prototype.display=function(t){this.visible=t},m.prototype.draw=function(t){this.visible&&(t.ctx.fillStyle=this.color,t.ctx.textAlign=this.align,t.ctx.textBaseline=this.baseline,t.ctx.font=this.weight+" "+this.size/this.scale+"px "+this.typeface,t.ctx.fillText(this.text,this.x,this.y))},i.Extend.proto(v,i.BaseComponent),v.prototype.setData=function(t){this.key=t.key,this.value=t.value,this.text.set(t.value)},v.prototype.size=function(t,i,e){this.pin.size(t,i,e),this.bounding=this.pin.bounding,this.text.scale=e,this.text.size=14,this.text.weight=600,this.width=t,this.height=i,this.scale=e},v.prototype.clone=function(){var t=new v(this.color);return t.parent=this,t.setData({key:this.key,value:this.value}),t.size(this.width,this.height,this.scale),t},v.prototype.place=function(t,i){this.pin.place(t,i+this.pin.height/2);var e=this.pin.bounding,s=e.left+(e.right-e.left)/2,n=e.top+17/this.scale;this.text.place({x:s,y:n}),this.x=t,this.y=i,this.bounding=this.pin.bounding,this.dimensions=this.pin.dimensions},v.prototype.getBounding=function(){return this.pin.bounding},v.prototype.move=function(t){this.exhausted||(this.pin.move(t.x,t.y),this.text.move(t.x,t.y),this.x=this.pin.x,this.y=this.pin.y,this.bounding=this.pin.bounding,this.dimensions=this.pin.dimensions)},v.prototype.hitTest=function(t){return this.pin.hitTest(t)},v.prototype.render=function(t){this.pin.draw(t),this.text.draw(t)},v.prototype.use=function(){this.placed+=1,this.available===this.placed&&(this.exhausted=!0,this.pin.setFill(this.exhaustedColor))},v.prototype.replenish=function(){this.available===this.placed&&(this.exhausted=!1,this.pin.setFill(this.defaultColor)),this.placed-=1},v.prototype.hover=function(t){this.exhausted||this.pin.setFill(t?this.hoverColor:this.defaultColor)};var b=new e.Color("#00cabf"),_=new e.Color("#007bbf");function C(){i.Extend.self(this,i.BaseComponent),this.width=0,this.height=0,this.scale=1,this.container=this.initComponent(o.Path),this.coords={x:0,y:0},this.active=!1,this.visible=!1,this.selected=null,this.bounding=null,this.dimensions=null,this.items=[]}i.Extend.proto(C,i.BaseComponent),C.prototype.inBounds=function(t){return t.x>=this.bounding.left&&t.x<=this.bounding.right&&t.y>=this.bounding.top&&t.y<=this.bounding.bottom},C.prototype.display=function(t){this.visible=t},C.prototype.load=function(t){this.active=!0;for(var i,e=b.blend(_,t.length),s=0;s<t.length;s++)(i=new v(e[s])).setData(t[s]),i.index=this.items.length,this.items.push(i)},C.prototype.size=function(t,i,s,n){var o=1!==n,h=this.items.length,a=5*(h-1),l=e.MathUtil.range(h,3,7,50,10),r=t-2*l,p=o?75:50,c=(r-a)/h;c=e.MathUtil.clamp(c,50,75);for(var u,d=s+i,y=l+r,f=d+p,g=[{x:l,y:d},{x:y,y:d},{x:y,y:f},{x:l,y:f}],x=l,m=d+p/2,v=-1;++v<h;)(u=this.items[v]).size(c,35,n),0===v?x+=u.pin.width/2+(r-u.pin.width*h+a)/2:v>0&&(x+=u.pin.width+5),u.place(x,m);this.height=p+5,this.width=t,this.scale=n,this.container.setPoints(g),this.bounding=this.container.getBounding()},C.prototype.check=function(t){for(var i=!1,e=!1,s=this.items.length;--s>-1&&!1===e;)e=this.items[s].hitTest(t),i=this.items[s];return!1!==e&&{action:e.action,target:e.target,tag:i}},C.prototype.select=function(t){if(!1===t.exhausted){var i=t.clone();return i.pin.setPoint(15,10),i.action="move",i.place(t.x,t.y+10/this.scale),i}return!1},C.prototype.use=function(t){for(var i=this.items.length;--i>-1;)t.key===this.items[i].key&&this.items[i].use()},C.prototype.replenish=function(t){for(var i=this.items.length;--i>-1;)this.items[i].key===t.key&&this.items[i].replenish();t=null},C.prototype.hover=function(t,i){for(var e=this.items.length;--e>-1;)this.items[e].hitTest(t)&&"over"===i?this.items[e].hover(!0):this.items[e].hover(!1)},C.prototype.render=function(t){for(var i=-1;++i<this.items.length;)this.items[i].render(t);this.selected&&this.selected.render(t)};var w=1-4/3*(Math.sqrt(2)-1);function k(t){i.Extend.self(this,i.BaseComponent),this.type="close",this.cursor="pointer",this.visible=!1,this.bounding=null,this.x=0,this.y=0,this.scale=1,this.radius=2,this.defaultColor="#00bcb7",this.bg=this.initComponent(o.Path),this.line0=this.initComponent(o.Path),this.line1=this.initComponent(o.Path),this.bg.fill=!0,this.line0.fill=!0,this.line1.fill=!0,this.bg.fillColor=this.defaultColor;for(var e={x:0,y:0},s=0;s<8;s++)this.bg.addPoint(e);this.bg.close(!0),this.line0.close(!0),this.line1.close(!0)}function P(t){i.Extend.self(this,i.BaseComponent),this.type="selection",this.shape="bounding_box",this.key=null,this.value=null,this.scale=1,this.complete=!1,this.drawing=!0,this.topRight=null,this.path=this.initComponent(o.Path),this.close=this.initComponent(k),this.bounding=null,this.path.close(!0),this.onDestroy=this.path.destroy,this.path.setPoints([t,t,t,t])}function E(t){i.Extend.self(this,i.BaseComponent),this.type="selection",this.shape="polygon",this.key=null,this.value=null,this.scale=1,this.drawing=!0,this.init=!1,this.topRight=null,this.complete=!1,this.next=null,this.path=this.initComponent(o.Path),this.close=this.initComponent(k),this.bounding=null,this.length=null,this.onDestroy=this.path.destroy}function B(t){i.Extend.self(this,i.BaseComponent),this.type="close",this.cursor="pointer",this.visible=!1,this.bounding=null,this.x=0,this.y=0,this.scale=1,this.radius=2,this.defaultColor="#00bcb7",this.bg=this.initComponent(o.Path),this.line0=this.initComponent(o.Path),this.line1=this.initComponent(o.Path),this.bg.fill=!0,this.line0.fill=!0,this.line1.fill=!0,this.bg.fillColor=this.defaultColor;for(var e={x:0,y:0},s=0;s<8;s++)this.bg.addPoint(e);this.bg.close(!0),this.line0.close(!0),this.line1.close(!0)}function z(t){i.Extend.self(this,i.BaseComponent),this.type="selection",this.shape="point",this.key=null,this.value=null,this.complete=!1,this.drawing=!0,this.scale=1,this.currentAlpha=0,this.point=this.initComponent(o.ReticlePoint),this.close=this.initComponent(B),this.close.display(n.System.mobile),this.point.x=t.x,this.point.y=t.y,this.getBounding=this.getBounding.bind(this),this.bounding=this.getBounding()}function T(t){i.Extend.self(this,i.BaseComponent),this.type="selection",this.shape="point",this.key=null,this.value=null,this.complete=!1,this.drawing=!0,this.scale=1,this.bounding=null,this.point=this.initComponent(o.Point),this.pin=this.initComponent(g),this.text=this.initComponent(m),this.close=this.initComponent(k),this.defaultColor="#fff",this.hoverColor="#00bcb7",this.point.x=t.x,this.point.y=t.y,this.defaultCloseColor="#fff",this.hoverCloseColor="#00bcb7",this.point.stroke=!0,this.point.fill=!1}function L(t){i.Extend.self(this,i.BaseComponent),this.scale=1,this.shape=t&&t.shape_type||"bounding_box",this.minSelections=t&&t.min_shapes_per_image||1,this.maxSelections=t&&t.max_shapes_per_image||4,this.minSize=t&&t.minimum_selection_area_per_shape||5,this.minPoints=t&&t.min_points||1,this.maxPoints=t&&t.max_points||4,this.autoClose=t&&t.autoClose||!0,this.maxShapes=1===this.maxSelections&&"point"===this.shape}function R(t){i.Extend.self(this,i.BaseComponent),this.scale=1,this.width=0,this.height=0,this.key=null,this.config=t.task||{},this.orientation=t.orientation||"portrait",this.shape=t.task.shape_type||"bounding_box",this.update={type:null,element:null,parent:null},this.cursor="default",this.userDraw=!0,this.area=this.initComponent(y,this.config),this.selections=this.initComponent(L,this.config),this.labels=this.initComponent(C)}function A(){i.Extend.self(this,i.DomComponent,"challenge-view"),this.scale=1,this._coords={x:0,y:0},this._cursor="default",this._lock=!1,this._task=null,this.config={orientation:"portrait",skipText:!1},this.header=this.initComponent(a.ChallengeHeader,{theme:r}),this.canvas=this.initComponent(o.Canvas),this.canvas.setAttribute("tabindex","0");var t=h.translate("Image-based CAPTCHA challenge. Please use the 'Accessibility: Retrieve Cookie' or 'Accessibility: Text Challenge' options if available in the challenge menu.");this.canvas.setAttribute("role","img"),this.canvas.setAttribute("aria-label",t);var e=M.bind(this),s=S.bind(this);this.render=this.render.bind(this),this.canvas.addEventListener("down",e),this.canvas.addEventListener("move",e),this.canvas.addEventListener("up",e),this.canvas.addEventListener("out",e),this.addEventListener("keydown",s)}function M(t){if(!this._lock&&(n.System.desktop||t.preventDefault(),3!==t.keyNum)){var i=this._task,s="default",o={x:Math.round(t.elementX/this.scale),y:Math.round(t.elementY/this.scale)},h={x:o.x,y:o.y};if(i){var a=i.check(o),l=i.area.inAssetBounds(o),r=i.area.inBounds(o),p=i.area.getAssetBounding();if(l&&(s="pointer"),"down"===t.action)!a&&i.userDraw?l&&i.create(o):("point"===i.shape&&i.selections.toggleReticle(o),"path"===a?l&&("polygon"===i.shape&&i.shouldClose(o)?i.setAnswer():i.draw(o,t.action,l)):(i.selectUI(o),i.hoverOn(o),i.isUpdating()&&"handle"===a&&(s="grabbing",h.x=i.update.element.x,h.y=i.update.element.y)));else if(!r&&i.userDraw||"up"===t.action||"out"===t.action)"point"===i.shape&&i.selections.toggleReticle(),a&&(!r&&n.System.mobile&&"path"===a&&"move"===t.action?i.draw({x:e.MathUtil.clamp(o.x,p.left,p.right),y:e.MathUtil.clamp(o.y,p.top,p.bottom)},"move",i.area.inAssetBounds(o),!0):("path"===a?i.draw(o,t.action,l):i.releaseUI(o),i.hoverOff(o)));else if("move"===t.action)if(a){if("path"===a)i.draw({x:e.MathUtil.clamp(o.x,p.left,p.right),y:e.MathUtil.clamp(o.y,p.top,p.bottom)},"move",l,!0);else if(i.hoverOn(o),i.isUpdating()){var c={x:e.MathUtil.clamp(o.x,p.left,p.right)-e.MathUtil.clamp(this._coords.x,p.left,p.right),y:e.MathUtil.clamp(o.y,p.top,p.bottom)-e.MathUtil.clamp(this._coords.y,p.top,p.bottom)};"handle"===a?(s="grabbing",i.moveHandle(c),h.x=i.update.element.x,h.y=i.update.element.y):"selection"!==a&&"label"!==a||("label"===a&&(c={x:o.x-this._coords.x,y:o.y-this._coords.y}),s="move",i.moveElement(c))}}else i.hoverOff(o)}this._coords=o,this._cursor!==s&&(this._cursor=s,this.canvas.css({cursor:s}))}}function S(t){9===t.keyNum&&t.shiftKey&&(this.emit("blur"),t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault())}function D(t){i.Extend.self(this,i.DomComponent,"challenge"),this.type="image_label_area_select",this.resolve=null,this.reject=null,this.breadcrumbs=0,this.served=0,this.mobile=!1,this.orientation="portrait",this._data=null,this._answers=Object.create(null),this._total=0,t&&this.theme(t.theme.name,t.theme.config),this.syncCheckState=this.syncCheckState.bind(this);var s=this;this.view=this.initComponent(A),this.view.on("update",this.syncCheckState),this.view.on("blur",(function(){s.emit("focus-check")})),e.Render.add(this.view.render),e.Render.fps(30)}return i.Extend.proto(k,i.BaseComponent),k.prototype.size=function(t,i){i===undefined&&(i=1);var e,s,n,o,h,a,l,r,p=2/i,c=12/i,u=(e=this.x,s=this.y,[{x:h=e-(n=p)/2,y:l=s-(o=c)/2},{x:a=e+n/2,y:l},{x:a,y:r=s+o/2},{x:h,y:r}]);this.line0.setPoints(u),this.line1.setPoints(u),this.line0.rotate(45),this.line1.rotate(-45);var d,y=this.radius/i,f=t/i/2,g=function(t,i,e,s,n){for(var o=n*w,h=0,a=0,l=[],r=0;r<4;r++){var p={x:0,y:0},c={x:0,y:0},u={x:0,y:0},d={x:0,y:0},y={x:0,y:0},f={x:0,y:0};h=r<2?i:t,a=0===r||3===r?e:s,0===r?(p.x=h-n,p.y=a,c.x=h,c.y=a+n,u.x=p.x-o,u.y=p.y,d.x=p.x+o,d.y=p.y,y.x=c.x,y.y=c.y-o,f.x=c.x,f.y=c.y+o):1===r?(p.x=h,p.y=a-n,u.x=p.x,u.y=p.y-o,d.x=p.x,d.y=p.y+o,c.x=h-n,c.y=a,y.x=c.x+o,y.y=c.y,f.x=c.x-o,f.y=c.y):2===r?(p.x=h+n,p.y=a,u.x=p.x+o,u.y=p.y,d.x=p.x-o,d.y=p.y,c.x=h,c.y=a-n,y.x=c.x,y.y=c.y+o,f.x=c.x,f.y=c.y-o):3===r&&(p.x=h,p.y=a+n,c.x=h+n,c.y=a,u.x=p.x,u.y=p.y+o,d.x=p.x,d.y=p.y-o,y.x=c.x-o,y.y=c.y,f.x=c.x+o,f.y=c.y),l.push({point:p,handleIn:u,handleOut:d}),l.push({point:c,handleIn:y,handleOut:f})}return l}(this.x-f,this.x+f,this.y-f,this.y+f,y);this.bg.forEachPoint((function(t){d=g[t.index],t.set.apply(t,[d.point,d.handleIn,d.handleOut]),t.tolerance=1!==i?10:0}),!0),this.bounding=this.bg.bounding,this.width=t,this.height=t,this.scale=i},k.prototype.display=function(t){this.visible=t},k.prototype.place=function(t){var i=t.x-this.x,e=t.y-this.y;this.x=t.x,this.y=t.y,this.bg.move(i,e),this.line0.move(i,e),this.line1.move(i,e),this.bounding=this.bg.bounding},k.prototype.move=function(t,i){this.x+=t,this.y+=i,this.bg.move(t,i),this.line0.move(t,i),this.line1.move(t,i),this.bounding=this.bg.bounding},k.prototype.hitTest=function(t){return this.bg.hitTest(t)},k.prototype.draw=function(t){this.visible&&(this.bg.draw(t),this.line0.draw(t),this.line1.draw(t))},k.prototype.setFill=function(t,i){this.bg.fillColor=t,i&&(this.line0.fillColor=i,this.line1.fillColor=i)},i.Extend.proto(P,i.BaseComponent),P.prototype.size=function(t){var i=1!==t;this.close.size(18,t),this.path.forEachPoint((function(t){t.radius=4,t.tolerance=i?50:10,t.fillColor="#fff"})),this.path.stroke=!0,this.path.strokeColor="rgba(255, 255, 255, 1)",this.path.strokeWidth=2,this.path.pointRadius=4,this.scale=t},P.prototype.draw=function(t,i,e,s){var n;"move"===i&&(e||!e&&s)&&(this.path.forEachPoint((function(i){if(n={x:i.x,y:i.y},1===i.index||2===i.index){var e=t.x-n.x;n.x+=e}if(2===i.index||3===i.index){var s=t.y-n.y;n.y+=s}i.set(n)})),this.bounding=this.path.getBounding())},P.prototype.move=function(t){this.path.forEachPoint((function(i){i.move(t.x,t.y)})),this.close&&this.close.move(t.x,t.y),this.bounding=this.path.getBounding()},P.prototype.adjust=function(t,i,e){var s,n={x:t.x+i.x,y:t.y+i.y},o=t.next,h=t.prev,a=o.y===t.y?o.x:h.x,l=o.x===t.x?o.y:h.y,r=a>t.x,p=l>t.y;(r&&n.x>a-e||!r&&n.x<a+e)&&(n.x=t.x),(p&&n.y>l-e||!p&&n.y<l+e)&&(n.y=t.y),this.path.forEachPoint((function(i){s={x:i.x,y:i.y},t.prev!==i&&t.next!==i||(t.x===i.x&&(s.x=n.x),t.y===i.y&&(s.y=n.y)),i.set(s)})),t.set(n),this.close.place(this.topRight),this.bounding=this.path.getBounding()},P.prototype.hover=function(t,i){if(!t)return this.close.setFill("#00bcb7"),this.path.strokeColor="#fff",this.path.forEachPoint((function(t){t.fillColor="#fff"})),!1;var e=this.path.hitTest(i),s=this.close.hitTest(i);return this.close.setFill(s?"#118683":"#00bcb7"),this.path.strokeColor=s||e&&"segment"===e.type?"#fff":"#00bcb7",this.path.forEachPoint((function(t){t.fillColor=s||e&&("segment"!==e.type||e.geometry!==t)?"#fff":"#00bcb7"})),!0},P.prototype.set=function(){var t=!1,i={x:this.bounding.right,y:this.bounding.top};return this.path.forEachPoint((function(e){(!1===t||e.getDistance(i)<t.getDistance(i))&&(t=e)})),this.topRight=t,this.close.place(this.topRight),this.close.display(!0),this.bounding=this.path.getBounding(),this.path.showPoints=!0,this.complete=!0,this.drawing=!1,!1},P.prototype.hitTest=function(t){var i=!1,e=this.path.hitTest(t);(e&&(i={element:"path"===e.type?this:e.geometry,type:"path"===e.type?"selection":"handle"}),this.close.visible)&&(this.close.hitTest(t)&&(i={element:this,type:"close"}));return i},P.prototype.getCoords=function(){var t=[];return this.path.forEachPoint((function(i){t.push(i.x),t.push(i.y)}),!0),t},P.prototype.render=function(t){this.path.draw(t),this.close.draw(t)},P.prototype.onDestroy=function(){this.path=this.path.destroy()},i.Extend.proto(E,i.BaseComponent),E.prototype.size=function(t){var i=1!==t;if(this.close.size(18,t),this.close.visible){var e={x:this.topRight.x+(i?35:15),y:this.topRight.y-(i?35:15)};this.close.place(e)}this.path.forEachPoint((function(t){t.radius=4,t.tolerance=i?50:10,t.fillColor="#fff"})),this.path.stroke=!0,this.path.strokeColor="rgba(255, 255, 255, 1)",this.path.strokeWidth=2,this.path.showPoints=!0,this.scale=t},E.prototype.draw=function(t,i,e){var s=1!==this.scale;if(this.next&&this.next.set(t),"up"===i&&e){var n=t;if(this.init)n={x:this.next.x,y:this.next.y},this.path.addPoint(this.next);else{this.init=!0;var h=this.path.addPoint(t);this.next=new o.Segment(t),h.radius=4,h.tolerance=s?50:10,h.fillColor="#fff"}this.next=new o.Segment(n),this.next.radius=4,this.next.tolerance=s?50:10,this.next.fillColor="#fff",this.length=this.path.getLength()}this.bounding=this.path.getBounding()},E.prototype.move=function(t){this.path.move(t.x,t.y),this.close.visible&&this.close.move(t.x,t.y),this.bounding=this.path.getBounding()},E.prototype.adjust=function(t,i){if(t.set({x:t.x+i.x,y:t.y+i.y}),this.bounding=this.path.getBounding(),this.close.visible){var e={x:this.topRight.x+12/this.scale,y:this.topRight.y-12/this.scale};this.close.place(e)}},E.prototype.set=function(){var t=1!==this.scale;this.bounding=this.path.getBounding(),this.length=this.path.getLength(),this.path.close(!0);var i=!1,e={x:this.bounding.right,y:this.bounding.top};this.path.forEachPoint((function(t){(!1===i||t.getDistance(e)<i.getDistance(e))&&(i=t)})),this.topRight=i;var s={x:this.topRight.x+(t?20:15),y:this.topRight.y-(t?20:15)};return this.close.display(!0),this.close.place(s),this.complete=!0,this.drawing=!1,!1},E.prototype.hitTest=function(t){var i=!1,e=this.path.hitTest(t);(e&&(i={element:"path"===e.type?this:e.geometry,type:"path"===e.type?"selection":"handle"}),this.close.visible)&&(this.close.hitTest(t)&&(i={element:this,type:"close"}));return i},E.prototype.getCoords=function(){var t=[];return this.path.forEachPoint((function(i){t.push(i.x),t.push(i.y)}),!0),t},E.prototype.render=function(t){this.path.draw(t),this.close.draw(t)},E.prototype.hover=function(t,i){if(!t)return this.close.setFill("#00bcb7"),this.path.strokeColor="#fff",this.path.forEachPoint((function(t){t.fillColor="#fff"})),!1;var e=this.path.hitTest(i),s=this.close.hitTest(i);return this.close.setFill(s?"#118683":"#00bcb7"),this.path.strokeColor=s||e&&"segment"===e.type?"#fff":"#00bcb7",this.path.forEachPoint((function(t){t.fillColor=s||e&&("segment"!==e.type||e.geometry!==t)?"#fff":"#00bcb7"})),!0},i.Extend.proto(B,i.BaseComponent),B.prototype.size=function(t,i){i===undefined&&(i=1);var e=2/i,s=10/i,n=function(t,i,e,s){var n=t-e/2,o=t+e/2,h=i-s/2,a=i+s/2;return[{x:n,y:h},{x:o,y:h},{x:o,y:a},{x:n,y:a}]}(this.x,this.y,e,s);this.line0&&this.line0.destroy(),this.line1&&this.line1.destroy(),this.bg&&this.bg.destroy(),this.line0.setPoints(n),this.line1.setPoints(n),this.line0.rotate(45),this.line1.rotate(-45);for(var o=this.radius/i,h=0;h<8;h++){var a=Math.PI/4*h,l=o,r=this.x+l*Math.cos(a),p=this.y+l*Math.sin(a);this.bg.addPoint({x:r,y:p})}this.bg.fillColor="#fff",this.bounding=this.bg.bounding,this.width=t,this.height=t,this.scale=i},B.prototype.display=function(t){this.visible=t},B.prototype.place=function(t){this.x=t.x,this.y=t.y,this.bg.move(this.x,this.y),this.line0.move(this.x,this.y),this.line1.move(this.x,this.y),this.bounding=this.bg.bounding},B.prototype.move=function(t,i){this.x+=t,this.y+=i,this.bg.move(t,i),this.line0.move(t,i),this.line1.move(t,i),this.bounding=this.bg.bounding},B.prototype.hitTest=function(t){return this.bg.hitTest(t)},B.prototype.draw=function(t){this.visible&&(this.bg.draw(t),this.line0.draw(t),this.line1.draw(t))},B.prototype.setFill=function(t,i){this.bg.fillColor=t,i&&(this.line0.fillColor=i,this.line1.fillColor=i)},i.Extend.proto(z,i.BaseComponent),z.prototype.size=function(t){this.close.size(18,t),this.close.setFill(l.Color.white,l.Color.grey.selected),this.point.fill=!0,this.point.strokeColor="rgba(255, 255, 255, 1)",this.point.radius=n.System.mobile?7.5:5,this.point.tolerance=n.System.mobile?20:10,this.scale=t},z.prototype.draw=function(t,i,e){"up"===i&&e&&(this.close.place(this.point),this.size(this.scale)),"move"===i&&e&&(this.point.x=t.x,this.point.y=t.y,this.bounding=this.getBounding())},z.prototype.move=function(t){this.point.x+=t.x,this.point.y+=t.y,this.bounding=this.getBounding()},z.prototype.set=function(){return this.point.fill=!0,this.point.stroke=!1,this.close.display(!0),this.bounding=this.getBounding(),this.complete=!0,this.drawing=!1,!0},z.prototype.hitTest=function(t){var i=!1,e=this.point.x-t.x,s=this.point.y-t.y;return Math.sqrt(e*e+s*s)<(n.System.mobile?40:25)&&(i={element:this,type:"close"}),i},z.prototype.getCoords=function(){return[this.point.x,this.point.y]},z.prototype.getBounding=function(){return{left:this.point.x-this.point.radius,right:this.point.x+this.point.radius,top:this.point.y-this.point.radius,bottom:this.point.y+this.point.radius}},z.prototype.render=function(t){this.point.draw(t),t.ctx.save(),this.close.draw(t),t.ctx.restore()},z.prototype.hover=function(t,i){return t?(this.point.hovered=!0,this.close.display(!0),this.point.fillColor=l.Color.white,!0):(this.point.hovered=!1,!1)},i.Extend.proto(T,i.BaseComponent),T.prototype.place=function(t){this.point.x=t.x,this.point.y=t.y,this.pin.place(t.x,t.y-this.bounding.bottom);var i=this.pin.bounding,e=i.top+17/this.scale,s=15/this.scale;this.close.place({x:i.left+s,y:e}),this.text.place({x:i.left+s+this.close.width+s,y:e}),this.bounding=i},T.prototype.size=function(t){this.pin.size(80,35,t);var i=this.pin.bounding,e=i.top+17/t,s=15/t;this.close.size(18,t),this.close.place({x:i.left+s,y:e}),this.text.scale=t,this.text.size=14,this.text.weight=600,this.text.place({x:i.left+s+this.close.width+s,y:e}),this.point.radius=5,this.point.strokeWidth=2,this.scale=t,this.width=80,this.height=35,this.bounding=i},T.prototype.draw=function(t,i,e){"move"===i&&e&&(this.point.x=t.x,this.point.y=t.y,this.bounding=this.pin.bounding)},T.prototype.move=function(t){this.point.x=this.point.x+t.x,this.point.y=this.point.y+t.y,this.bounding=this.pin.bounding,this.pin.move(t.x,t.y),this.text.move(t.x,t.y),this.close.move(t.x,t.y)},T.prototype.set=function(){return this.close.display(!0),this.text.display(!0),this.bounding=this.pin.bounding,this.complete=!0,this.drawing=!1,!0},T.prototype.applyLabel=function(t){this.key=t.key,this.value=t.value,this.text.set(t.value)},T.prototype.applyColor=function(t){this.color=t,this.hoverColor=t.clone().lightness(.35).getHex(),this.defaultColor=t.getHex(),this.defaultCloseColor=t.clone().lightness(.35).getHex(),this.hoverCloseColor=t.clone().lightness(.7).getHex(),this.pin.setFill(this.defaultColor),this.close.setFill(this.defaultCloseColor),this.point.strokeColor=t.clone().saturation(.6).lightness(.9).getHex()},T.prototype.hitTest=function(t){var i=!1,e=this.point.hitTest(t),s=this.pin.hitTest(t);((e||s)&&(i={element:this,type:"selection"}),this.close.visible)&&(this.close.hitTest(t)&&(i={element:this,type:"close"}));return i},T.prototype.getCoords=function(){return[this.point.x,this.point.y]},T.prototype.render=function(t){this.point.draw(t),this.pin.draw(t),this.close.draw(t),this.text.draw(t)},T.prototype.hover=function(t,i){if(!1===t)return this.close.setFill(this.defaultCloseColor),this.pin.setFill(this.defaultColor),!1;var e=this.close.hitTest(i);return this.close.setFill(e?this.hoverCloseColor:this.defaultCloseColor),this.pin.setFill(e?this.defaultColor:this.hoverColor),!0},T.prototype.minimize=function(t){this._minimized=t,this.offset=t?0:this.close.width+(this.mobile?10:0),this.pin.opacity=t?.8:1,this.close.display(!t),this.text.display(!t),this.pin.minimize(t)},i.Extend.proto(L,i.BaseComponent),L.prototype.size=function(t,i){for(var e=this.children.length;--e>-1;)this.children[e].size&&this.children[e].size(i);this.scale=i},L.prototype.create=function(t,i){if(this.children.length<this.maxSelections){var e=P;"polygon"===t&&(e=E),"point"===t&&(e=z),"pin"===t&&(e=T);var s=this.initComponent(e,i);return s.size(this.scale),s}return null},L.prototype.isComplete=function(t){return"bounding_box"===t.shape||"point"===t.shape||("polygon"===t.shape?t.drawing&&t.length===this.maxPoints&&this.autoClose:void 0)},L.prototype.set=function(t){var i=!1;if(t.bounding){if("bounding_box"===t.shape||"polygon"===t.shape){var e=Math.abs(t.bounding.left-t.bounding.right),s=Math.abs(t.bounding.top-t.bounding.bottom);if(!(i=e>this.minSize&&s>this.minSize))return this.remove.call(this,t),!0}else"point"===t.shape&&(i=!0);return!!i&&(t.set(),!0)}},L.prototype.check=function(t){for(var i=this.children.length,e=!1;--i>-1&&!e;)(e=this.children[i].hitTest(t))&&(e.selection=this.children[i]);return e},L.prototype.remove=function(t){for(var i=this.children.length;--i>-1;)this.children[i]===t&&this.children.splice(i,1);t.destroy&&t.destroy(),t=null},L.prototype.minimize=function(t,i){for(var e=this.children.length;--e>-1;)this.children[e]!==i&&this.children[e].minimize&&this.children[e].minimize(t)},L.prototype.getLength=function(){return this.children.length},L.prototype.getLastTask=function(){return this.children.length>0?this.children[this.children.length-1]:null},L.prototype.render=function(t){for(var i=-1;++i<this.children.length;)this.children[i].render(t)},L.prototype.hover=function(t,i){for(var e=this.children.length,s=!1;--e>-1;)!1===t?this.children[e].hover(!1):this.children[e].hitTest(i)&&!s?s=this.children[e].hover(t,i):this.children[e].hover(!1);return s},L.prototype.toggleReticle=function(t){for(var i=0;i<this.children.length;)t||(this.children[i].point.complete=!0),i++},L.prototype.closeCheck=function(t){for(var i=this.children.length,e=!1;--i>-1&&!e;)e=this.children[i].close.hitTest(t);return e},i.Extend.proto(R,i.BaseComponent),R.prototype.setAnswer=function(){if(this.update.element){var t=this.update.element;this.selections.set(t)&&(this.update.type=null,this.update.element=null,this.update.parent=null,this.emit("update"))}},R.prototype.display=function(t){this.visible=t,this.area.display(t),this.labels.active&&this.labels.display(t)},R.prototype.load=function(t){var i=this,e=t.task.datapoint_uri,s=t.answers;this.display.call(this,!1);var n=[this.area.load(e)],o=[];for(var h in s)o.push({key:h,value:s[h]});return o.length>1&&o.length<=7&&"point"===this.shape&&(n.push(this.labels.load(o)),this.selections.on("remove",this.labels.replenish.bind(this.labels)),this.userDraw=!1),this.key=t.task.task_key,this.options=o,Promise.all(n).then((function(){i.display.call(i,!0)}))},R.prototype.size=function(t,i){var e=350,s=500;"landscape"===this.orientation&&(e=215,s=440);var n=e,o=s;this.area.size(o,n,t,i),this.selections.size(t,i),this.labels.active&&this.labels.size(o,n,t,i),this.width=o,this.height=this.labels.active?n+this.labels.height:n,this.scale=i},R.prototype.check=function(t){if(this.update.element)return this.update.type;if(this.labels.visible&&this.labels.inBounds(t))return!!this.labels.check(t)&&"label";var i=this.selections.check(t);return!!i&&("selection"!==i.type||i.element.complete?i.type:"path")},R.prototype.create=function(t){var i=this.selections.create(this.shape,t);this.update={type:"path",element:i,parent:null}},R.prototype.isUpdating=function(){return null!==this.update.element},R.prototype.isDrawn=function(){return null!==this.update.element&&this.update.element.complete},R.prototype.draw=function(t,i,e,s){var n=this.update.element;n.draw(t,i,e,s),"up"!==i&&"out"!==i||this.selections.isComplete(n)&&this.setAnswer()},R.prototype.selectUI=function(t){if(this.labels.visible&&this.labels.inBounds(t)){var i=this.labels.check(t);if(i){var e=this.labels.select(i.tag);e&&(this.update={type:"label",element:e,parent:null},this.labels.use(i.tag),this.labels.hover(t,"out"),this.selections.minimize(!0))}}else{var s=this.selections.check(t);s&&(this.update={type:s.type,element:s.element,parent:s.selection})}},R.prototype.releaseUI=function(t){var i=this.update.element,e=this.update.parent;if("close"===this.update.type&&(this.labels.visible&&(this.labels.replenish(e),this.selections.minimize(!1)),this.selections.remove(this.update.parent),this.emit("update")),"label"===this.update.type){var s=this.area.inBounds({x:i.x,y:i.y})?this.selections.create("pin",{x:i.x,y:i.bounding.bottom}):null;s?(s.applyColor(i.color),s.applyLabel({key:i.key,value:i.value}),s.place(s.point),this.selections.set(s),this.emit("update")):this.labels.replenish(i),this.selections.minimize(!1)}this.update.type=null,this.update.element=null,this.update.parent=null,this.cursor="default"},R.prototype.moveHandle=function(t){var i=this.update.element,e=this.update.parent,s=this.area.getAssetBounding();t.x+i.x>s.right?t.x=s.right-i.x:t.x+i.x<s.left&&(t.x=s.left-i.x),t.y+i.y>s.bottom?t.y=s.bottom-i.y:t.y+i.y<s.top&&(t.y=s.top-i.y),e.adjust(i,t,this.selections.minSize)},R.prototype.moveElement=function(t){var i=this.update.element;if("selection"===this.update.type){var e=i.bounding,s=this.area.getAssetBounding();t.x+e.right>s.right?t.x=s.right-e.right:t.x+e.left<s.left&&(t.x=s.left-e.left),t.y+e.bottom>s.bottom?t.y=s.bottom-e.bottom:t.y+e.top<s.top&&(t.y=s.top-e.top)}i.move(t),this.cursor="grabbing"},R.prototype.hoverOn=function(t){var i=null;if(this.labels.visible&&this.labels.inBounds(t))return i=this.labels.check(t),this.labels.hover(t,i?"over":"out"),this.cursor="pointer",!0;if(!this.area.inBounds(t))return this.selections.hover(!1),this.cursor="default",!1;var e=this.selections.hover("selection"!==this.update.type||n.System.mobile,t);return this.cursor=e?"pointer":"default","pointer"===this.cursor},R.prototype.hoverOff=function(t){this.labels.visible&&this.labels.hover(t,"out"),this.selections.hover(!1)},R.prototype.shouldClose=function(t){var i=this.update.element.hitTest(t);return!(!i||"handle"!==i.type||0!==i.element.index)},R.prototype.getTaskAsset=function(t){return this.area.asset},R.prototype.prerender=function(t){this.area.render(t)},R.prototype.render=function(t){this.area.render(t),this.selections.render(t),this.labels.visible&&this.labels.render(t),this.selection&&this.selection.render(t),"label"!==this.update.type||this.update.element.complete||this.update.element.render(t)},R.prototype.getAnswers=function(){var t=[],i=this.selections.children,s=this.area.getAssetBounding(),n=this.area.getAssetScale();e.TaskContext.set(this.key,[n,s.left||0,s.top||0]);for(var o=0;o<i.length;o++){for(var h=i[o].getCoords(),a=o,l=0;l<h.length;l+=2)h[l]=Math.round((h[l]-s.left)/n),h[l+1]=Math.round((h[l+1]-s.top)/n);t.push({entity_name:a,entity_type:i[o].key||this.options[0].key,entity_coords:h})}return t},i.Extend.proto(A,i.DomComponent),A.prototype.lock=function(t){this._lock=t},A.prototype.display=function(t){this.header.display(t)},A.prototype.focus=function(){this.canvas.focus()},A.prototype.style=function(t,i){var e="landscape"===this.config.orientation,s=i?(e?t+60:t)/500:1,o=this.header.style(t,10,i).height+10;this.header.setCopy(),this.top=o/s,this._task.size(this.top,s,i),this.canvas.css({position:"absolute",top:0,cursor:this._cursor,zIndex:10}),o+=this._task.height*s,this.canvas.dpr=n.System.mobile&&this.canvas.dpr>1?Math.round(this.canvas.dpr):2,this.canvas.scale=s,this.canvas.dimensions(t,o),this.css({width:t,height:o,borderRadius:4,overflow:"hidden"}),this.width=t,this.height=o,this.scale=s,this.mobile=i},A.prototype.render=function(){this.canvas.ctx&&(this.canvas.clear(),this._task&&this._task.render(this.canvas))},A.prototype.clear=function(){this._task&&(this._task=this._task.destroy())},A.prototype.isEmpty=function(){return 0===this._task.selections.getLength()},A.prototype.setup=function(t,i){var e=t.requester_question,s=t.requester_question_example;this.config={orientation:i.orientation,skipText:t.show_skip_text},this.header.load(e,s,i),this.header.setCopy()},A.prototype.createTask=function(t,i,e,s){var n=this,o=[];return this._task?this._task=this._task.destroy():(this.translate(),this.header.load(t,i,this.config),this.header.setCopy()),this._task=this.initComponent(R,{task:s,orientation:this.config.orientation}),this._task.size(this.top,this.scale,this.mobile),this._task.on("update",(function(t){n.emit("update",!n.isEmpty())})),o.push(n._task.load(e)),Promise.all(o).then((function(){n.style.call(n,n.width,n.mobile)}))},A.prototype.getResults=function(){var t=this._task.getAnswers();return{key:this._task.key,answers:t}},A.prototype.translate=function(){if(this.header.setCopy(),this.canvas){var t=h.translate("Image-based CAPTCHA challenge. Please use the 'Accessibility: Retrieve Cookie' or 'Accessibility: Text Challenge' options if available in the challenge menu.");this.canvas.setAttribute("role","img"),this.canvas.setAttribute("aria-label",t)}},i.Extend.proto(D,i.DomComponent),D.prototype.style=function(t,i){var e=this;this.mobile=t<=650;var s=this.mobile?300:500;return"landscape"===this.orientation&&(this.mobile=!0,s=440),new Promise((function(t,i){e.view.style(s,e.mobile),e.css({width:s,height:e.view.height}),t({width:s,height:e.view.height,mobile:e.mobile})}))},D.prototype.setup=function(i,s){var n=this,o=this.view;return this._data=i,this._total=i.tasklist.length,this._answers=Object.create(null),this.served=0,this.breadcrumbs=this._total,this.view.clear(),this.view.lock(!0),this.view.display(!1),this.emit("display-check",!1),new Promise((function(h,a){if(i.tasklist&&0!==i.tasklist.length){n.orientation=s||"portrait";var l={task:i.tasklist[0],answers:i.requester_restricted_answer_set};o.setup(i,{orientation:s}),o.createTask(i.requester_question,i.requester_question_example,l,i.request_config).then((function(){n.served+=1,e.Render.start(n.view.render),n.view.lock(!1),n.view.display(!0),n.syncCheckState()}))["catch"]((function(i){a({event:t.CaptchaError.CHALLENGE_ERROR,message:"Failed to setup task: "+n.served+" / "+n._total,reason:i})}))}else a({event:t.CaptchaError.CHALLENGE_ERROR,message:"Missing tasklist"});n.resolve=h,n.reject=a}))},D.prototype.setFocus=function(){this.view.focus()},D.prototype.syncCheckState=function(){var t=function(t,i){if(!t||t.tasklist&&0===t.tasklist.length)return!1;for(var e=0;e<t.tasklist.length;e++){var s=i[t.tasklist[e].task_key];if(s&&s.length>0)return!0}return!1}(this._data,this._answers),i=!this.view.isEmpty();this.emit("display-check",i||t)},D.prototype.submit=function(){var i=this,s=this._data,n=this.view.getResults(),o=this.served===this._total;if(this._answers[n.key]=n.answers,this.view.lock(!0),o){var h;e.Render.stop(this.view.render);for(var a=!1,l=0;l<s.tasklist.length;l++)if(h=s.tasklist[l].task_key,!this._answers[h]){a=!0;break}!this._answers||a?this.reject({event:t.CaptchaError.CHALLENGE_ERROR,message:"Answers are incomplete"}):this.resolve(this._answers)}else{var r={task:s.tasklist[this.served],answers:s.requester_restricted_answer_set};this.view.createTask(s.requester_question,s.requester_question_example,r,s.request_config).then((function(){i.served+=1,i.view.lock(!1),i.syncCheckState()}))["catch"]((function(e){i.reject({event:t.CaptchaError.CHALLENGE_ERROR,message:"Failed to setup task: "+i.served+" / "+i._total,reason:e})}))}},D.prototype.translate=function(){this.view.translate()},D.prototype.onDestroy=function(){e.Render.stop(this.view.render)},D.prototype.theme=function(t,i){i?(r.add("custom",r.extend(r.active(),i)),r.use("custom")):r.use(t)},D}(_sharedLibs.packages.constants,_sharedLibs.packages.core,_sharedLibs.packages.utils,_sharedLibs.packages.theme,_sharedLibs.packages.device,_sharedLibs.packages.canvas,_sharedLibs.packages.language,_sharedLibs.packages.ui,_sharedLibs.packages.config);
